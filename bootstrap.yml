---

- hosts: all
  become: true
  pre_tasks:

    - name: install updates (Ubuntu)
      tags: always
      apt:
        update_cache: yes
      when: ansible_distribution == "Ubuntu"


- hosts: all
  become: true
  tasks: 

    - name: create chxnedu user
      tags: always
      user:
        name: chxnedu
        group: root

    - name: add ssh key for chxnedu
      tags: always
      authorized_key: 
        user: chxnedu
        key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwTziN8IVNxdBFzE6E3fl1L7W2d/U+gDhX48khNBwfQ1GtJF7m9SLf1ifMnC72ncne15tuUHbn7ShsZp29lTPxqapStjTccAE9YeOyorV8dnfjsBP3gph1xTWfsv8ZGnfWFDIZJ87Ea3RVCamvYp5lV9UbwRZL41dJShc2VnoJ/SFhd+A/9GzseUtnYZSwJEBxE/u6sAo8nVkVmMjTok0BcPiw0+NgscwACLLDr27fl1hPjo3IGqLHZlD8hz3kQnIn8FGp5pVLh8ybSjdJH+H9+1NgOyMZwsMu+nRDCB4O/tM41jMnBROpQ2jLKO+yTRgXqmlYD8sqpOkh6xtqfxfcs53uvueJPN6drHf48U73qJi2LU0vUPRSPFpbTffxjBs/t/2zLbrxf3TgNcozV9Pw26KYVY/X1Rvri9ey0Oiw4g35BsDQ1ZCJlbffMcCOrWOEXdQB0I/dZE/z0L3dzLFhNr5T6ZVX509oO9PQkRza2jXXoLLDts9INK5L3vJxyOc= ubuntu@ip-172-31-80-92


    - name: add sudoers file for chxnedu
      tags: always
      copy: 
        src: sudoer_chxnedu
        dest: /etc/sudoers.d/chxnedu
        owner: root
        group: root
        mode: 0440
